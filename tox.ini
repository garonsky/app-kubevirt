[tox]
envlist = linters
minversion = 2.3
skipsdist = True
sitepackages=False
toxhelmdir = {toxinidir}/helm-charts-rendered

[testenv]
stxdir = {toxinidir}
kubevirtdir = {[testenv]stxdir}/
helmdir = {[testenv]kubevirtdir}stx-kubevirt-app-helm/stx-kubevirt-app-helm/helm-charts/kubevirt-app/
install_command = pip install -U {opts} {packages}
setenv =
   VIRTUAL_ENV={envdir}
   OS_STDOUT_CAPTURE=1
   OS_STDERR_CAPTURE=1
   OS_DEBUG=1
   OS_LOG_CAPTURE=1
deps =
  -r{toxinidir}/requirements.txt
  -r{toxinidir}/test-requirements.txt
whitelist_externals =
  bash

[testenv:bashate]
# Treat all E* codes as Errors rather than warnings using: -e 'E*'
commands =
  bash -c "find {toxinidir}                   \
         -not \( -type d -name .?\* -prune \) \
         -type f                              \
         -not -name \*~                       \
         -not -name \*.md                     \
         -name \*.sh                          \
         -print0 | xargs -r -n 1 -0 bashate -v\
         -e 'E*'"

[testenv:linters]
commands =
    {[testenv:bashate]commands}
    {[testenv:yamllint]commands}

[testenv:yamllint]
basepython=python3
commands = bash -c "find ./ -iname '*.yaml' -type f -not -name 'metadata.yaml' -print0 | xargs -0 cat |  sed  's/\s*\{\{.*\}\}//' | yamllint -d relaxed -f parsable - ;[ $? -eq 0 ] && exit 0 || exit 1"

[testenv:pylint]
basepython = python3
description = Dummy environment to allow pylint to be run in subdir tox
